### Cedar configuration file ###

######################## Common parameters to all the subdetectors ########################
#
# The following parameters are read by NA62VReconstruction::ParseConfigFile
#

# Data source ID as specified in "NA62 Data Formats": 8-bit identifier specifying the sub-detector generating the data
# expressed in hexadecimal
DetID= 0x04

# Total number of stations
NStations= 1

# Total number of channels
NChannels= 3072

# Enable (1) or disable (0) T0 and StationsT0
EnableStationsT0= 1
EnableTriggerDriftT0= 0
EnableROMezzaninesT0= 1
EnableT0= 1

# Names of files containing the MezzanineT0 and T0 constants
ROMezzaninesT0FileInput= Cedar-CoarseT0.dat
T0FileInput= Cedar-T0.dat

# Enable (1) or disable (0) histograms for T0 evaluation
# bit 0: T0 histo (to cross-check T0 evaluation)
# bit 1: NoT0 histo (to evaluate fineT0s)
# bit 2: PrimNoT0 histo (to evaluate fineT0s for L0)
T0HistoMask= 3

# Enable (1) or disable (0) histograms for individual channels (time, width, slewing)
EnableChannelHistograms= 0

# header text file output by encoding to be used in input for L1 trigger tests
# this will contain the recipe to process the binary file: 
# general info - binary filename, sub-detector ID, number of readout boards, number of processed events
# event-based info - event length, event timestamp, event length per readout board
HeaderFileName= Cedar_header.txt

# raw binary file output by encoding to be used in input for L1 trigger tests (together with header text file) 
# this will contain the event data block as specified in "NA62 Data Formats"
BinaryFileName= Cedar.dat

# ------------------------------- Digitizer configuration ------------------------------- #
# Station MC ToF [ns], one value for each station
StationsMCToF= 268.34

# ----------------------------- Online Monitor configuration ---------------------------- #
# Set the number of bursts after which the OM histos are reset 
# If the value is <=0 the OM histos are never reset
OnlineMonitorAccumulation= 1

################################## Cedar Reconstruction ###################################

# Octants are numbered 1-8, ordered clockwise looking in the K beam direction.
# The Saleve (Jura) octants are numbered 1-4 (5-8).
# Octant 1 is top Saleve (=top right looking along the K beam).
# The following settings allow disabling the octants (the corresponding Digis are neglected).

OctantsEnabled 1 1 1 1 1 1 1 1

# Minimal coincidence (sectors, PMTs) in a good kaon candidate.
# This does not affect the reconstruction, however affects monitoring plots,
# GetStreamInfo()->GetRecoInfo().GetKaonRate(), etc.
MinSectors= 4
MinPMTs= 4

# Edge requirement for the hit reconstruction:
#  1 = at least one leading,  2 = at least one trailing, 3 = leading+trailing (default)
#  0 = every possible hit (at least one leading or at least one trailing)
# -1 = leading only,         -2 = trailing only
EdgeRequirement= 1

# Width of the reconstruction time window [ns]. Standard value: 5 [2 in high-intensity environment].
TimeWindow= 2

# Iterations of the candidate clustering procedure
# 1: a new cluster is defined if a hit away more than 0.5*TimeWindow
#    from the existing cluster is found
# 2: clusters not fulfilling the minimal coincidence request or closer than
#    TimeWindow to a larger cluster are checked in order to include them
#    in existing bigger clusters
NCandidateClusteringIterations= 2

# Enable (1) or disable (0) slewing corrections
EnableSlewingCorrection= 1

# Ask for calculation of slewing corrections (0 = disabled, 1 = enabled).
# Enabling the slewing corrections also enables histograms for individual channels.
# EnableSlewingCorrection is disabled automatically if EvaluateSlewingCorrection is requested.
EvaluateSlewingCorrection= 0

# Fitting interval for re-evaluation of the slewing correction [ns]
NewMinWidth= 10
NewMaxWidth= 16

# Name of file containing the slewing correction constants
SlewingCorrectionFileInput= Cedar-SlewingCorr.dat

###########################################################################################
#
#          Cedar digitiser setup
#   v1.0 : 2014-07-14
#          David Hutchcroft: same settings as in CedarReconstruction.cc
#          SVN revison 341 
#
###########################################################################################

PrintCedarParameters = 0

# PMT time response curve (time unit: ns)
# fed into a TF1 so any ROOT function allowed
PMTTime_Response = TMath::Gaus(x, 0, 0.161203) + \
                 0.1101571*TMath::Gaus(x, -0.1750211, 0.30081) + \
                 0.0290554*TMath::Exp(1.03047*(0.557182-2*x))*\
                 (1-TMath::Erf((0.282630-x)/0.0885416)) + \
                 0.0066920*TMath::Gaus(x, 1.47462, 0.167551)

# range for PMT curve validity [ns]
PMTTime_min = -3.
PMTTime_max = 2.

# width of PMT time output [ns]
PMTWidth_mean = 14.
PMTWidth_sigma = 1.

# Set the additional global PMT efficiency.
# No additional inefficiency (1.0) corresponds to mean N(hits) per kaon = 32 in 2015 conditions.
PMT_Efficiency = 0.7

# set hit merge threshold [ns]
PMT_MergeThreshold = 15.

# -------------------- Online Monitor configuration -------------------- #
# Minimum number of hits in one burst required to reset alignment histos
ResetOMAlignmentNEvents= 20000
# ---------------------------------------------------------------------- #


# -------------------- ALIGNMENT CONFIGURATION --------------------

# The alignment procedure uses MC templates with the expected
# PMT hit distribution for a range of CEDAR misalignments. Different
# MC template files are required for different diaphragm apertures.
# The contributions from pions and kaons are stored in separate files

# Enable (1) or disable (0) the alignment computation
AlignmentEnabled= 0

#Templates file for plots using ALL events
AlignmentAllTemplate 1 Conditions/Cedar/CedarAlignmentTemplates/Cedar-AlignmentTemplate.mc_1710_1500_42.all.root
#AlignmentAllTemplate 1 Conditions/Cedar/CedarAlignmentTemplates/Cedar-AlignmentTemplate.mc_1710_1000_52.all.root

#Templates file for plots using SELECTED events (5 or more sectors)
AlignmentSelectedTemplate 1 Conditions/Cedar/CedarAlignmentTemplates/Cedar-AlignmentTemplate.mc_1710_1500_42.5fold.root
#AlignmentSelectedTemplate 1 Conditions/Cedar/CedarAlignmentTemplates/Cedar-AlignmentTemplate.mc_1710_1000_52.5fold.root

# RawDecoder channel mapping and other relevant parameters
RawDecoderSettingsFileInput= Cedar-RawDecoderSettings.dat
