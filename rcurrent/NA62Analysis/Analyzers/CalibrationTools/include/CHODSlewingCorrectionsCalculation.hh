// -------------------------------------------------------------
// History:
//
// Created by Viacheslav Duk (viacheslav.duk@cern.ch)
// and Riccardo Lollini (riccardo.lollini@cern.ch) 2017-04
//
// -------------------------------------------------------------

#ifndef CHODSLEWINGCORRECTIONSCALCULATION_HH
#define CHODSLEWINGCORRECTIONSCALCULATION_HH

#include <stdlib.h>
#include <vector>
#include "Analyzer.hh"
#include <TCanvas.h>
#include <TProfile.h>

class TH1I;
class TH2F;
class TGraph;
class TTree;

class CHODSlewingCorrectionsCalculation : public NA62Analysis::Analyzer
{
	public:
		explicit CHODSlewingCorrectionsCalculation(NA62Analysis::Core::BaseAnalysis *ba);
		~CHODSlewingCorrectionsCalculation();
		void InitHist();
		void InitOutput();
		void DefineMCSimple();
		void ProcessSpecialTriggerUser(Int_t, UInt_t);
		void Process(Int_t);
		void PostProcess();
		void StartOfBurstUser();
		void EndOfBurstUser();
		void StartOfRunUser();
		void EndOfRunUser();
		void EndOfJobUser();
		void ExportPlot();
		void DrawPlot();


private:
  
  Double_t fT0[2048];

  Bool_t fReadingData;
  TH2F * fHTime;
  TH2F * fHTotIP[128][16];
  TH1F * fHVelocity[128];
  TH1F * fHTotVsIP[128];
  TProfile * fHTotProfile[128][16];
  TH1D * fHTotProjection[128][16];
  TH1D * fHTimeIP[128][16];

  Int_t fFitStatus;

  Double_t fLightVelocities[128];
  // units: [cm]
  Double_t fSlabWidth[128] = {6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5,
			     9.9, 9.9, 9.9, 9.9, 9.9, 9.9, 9.9, 9.9, 9.9, 9.9,
			     6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5,
			     9.9, 9.9, 9.9, 9.9, 9.9, 9.9, 9.9, 9.9, 9.9, 9.9,
			     6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5,
			     9.9, 9.9, 9.9, 9.9, 9.9,
			     6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5,
			     9.9, 9.9, 9.9, 9.9, 9.9, 9.9, 9.9, 9.9, 9.9, 9.9,
			     6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5,
			     9.9, 9.9, 9.9, 9.9, 9.9};

  Double_t fPMCoordinate[128] = {0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
				1.9, 8.4, 14.9, 21.4, 31.3, 41.2, 51.1, 61.0,
				60.0, 69.9, 79.8, 89.7, 99.6, 106.1, 112.6, 119.1,
				121.0, 121.0, 121.0, 121.0, 121.0, 121.0, 121.0, 121.0,
				0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
				1.9, 8.4, 14.9, 21.4, 31.3, 41.2, 51.1, 61.0,
				60.0, 69.9, 79.8, 89.7, 99.6, 106.1, 112.6, 119.1,
				121.0, 121.0, 121.0, 121.0, 121.0, 121.0, 121.0, 121.0,
				60.0, 69.9, 79.8, 89.7, 99.6, 106.1, 112.6, 119.1,
				121.0, 121.0, 121.0, 121.0, 121.0, 121.0, 121.0, 121.0,
				0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
				1.9, 8.4, 14.9, 21.4, 31.3, 41.2, 51.1, 61.0,
				60.0, 69.9, 79.8, 89.7, 99.6, 106.1, 112.6, 119.1,
				121.0, 121.0, 121.0, 121.0, 121.0, 121.0, 121.0, 121.0,
				0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
				1.9, 8.4, 14.9, 21.4, 31.3, 41.2, 51.1, 61.0};

  Double_t fOtherEndCoordinate[128] = {121.0, 121.0, 121.0, 121.0, 121.0, 121.0, 121.0, 121.0,
				      121.0, 121.0, 121.0, 121.0, 121.0, 121.0, 121.0, 121.0,
				      0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
				      0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
				      121.0, 121.0, 121.0, 121.0, 121.0, 121.0, 121.0, 121.0,
                                      121.0, 121.0, 121.0, 121.0, 121.0, 121.0, 121.0, 121.0,
				      0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                                      0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
				      0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                                      0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
				      121.0, 121.0, 121.0, 121.0, 121.0, 121.0, 121.0, 121.0,
                                      121.0, 121.0, 121.0, 121.0, 121.0, 121.0, 121.0, 121.0,
				      0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                                      0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
				      121.0, 121.0, 121.0, 121.0, 121.0, 121.0, 121.0, 121.0,
                                      121.0, 121.0, 121.0, 121.0, 121.0, 121.0, 121.0, 121.0};

  Double_t fSlabLimitsX[33] = {-1210.,-1110.,-1010.,-910.,-810.,-710.,-650.,-580.5,-520.,-450.5,-390.,
			       -320.5,-260.,-190.5,-130.,-60.5,0.,60.5,130.,190.5,260.,320.5,
			       390.,450.5,520.,580.5,650.,710.,810.,910.,1010.,1110.,1210.};
  Double_t fSlabLimitsY[33] = {-1210.,-1110.,-1010.,-910.,-810.,-710.,-650.,-580.5,-520.,-450.5,-390.,
			       -320.5,-260.,-190.5,-130.,-60.5,0.,60.5,130.,190.5,260.,320.5,
			       390.,450.5,520.,580.5,650.,710.,810.,910.,1010.,1110.,1210.};
  Double_t fSlabCenter[128]; // x coordinate for 0<=i<64, y coordinate for 64<=i<128 

protected:

};
#endif
